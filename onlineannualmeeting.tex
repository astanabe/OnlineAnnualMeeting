\documentclass[titlepage,10pt,a4paper,uplatex]{jsbook}

\usepackage[utf8]{inputenc}

\usepackage[T1]{fontenc}

\usepackage[uplatex,deluxe]{otf}

\usepackage[noto]{pxchfon}

\setcounter{tocdepth}{3}

\usepackage[round,colon,authoryear]{natbib}

\usepackage[dvipdfmx, hiresbb]{graphicx, xcolor}

\usepackage{grffile}

\usepackage[%
dvipdfm,%
pdfstartview={FitH -32768},%    描画領域の幅に合わせる
bookmarks=true,%                しおり付き
bookmarksnumbered=false,%        章や節の番号をふる
bookmarkstype=toc,%             目次情報のファイル.tocを参照
colorlinks=true,%              ハイパーリンクを色文字に
linkcolor=black,%       link の枠の色 black
citecolor=black,%       cite の枠の色 black
urlcolor=black,%        url の枠の色 black
pdftitle={WordPressによる学会オンライン大会サイト構築法},%
pdfauthor={田辺晶史},
pdfkeywords={学会, 大会, 年会, 運営, 構築}%
]{hyperref}

\usepackage{pxjahyper}

\usepackage{amsmath,amssymb}

\AtBeginDocument{
  \abovedisplayskip     =0.5\abovedisplayskip
  \abovedisplayshortskip=0.5\abovedisplayshortskip
  \belowdisplayskip     =0.5\belowdisplayskip
  \belowdisplayshortskip=0.5\belowdisplayshortskip}

\usepackage{newtxtext,newtxmath}

\usepackage{textcomp}

\usepackage[prefernoncjk]{pxcjkcat}

\cjkcategory{sym18,grek}{cjk}

\usepackage{url}

\usepackage{booktabs}

\usepackage{multirow}

\usepackage{threeparttable}

\usepackage{longtable}

\usepackage{lineno}

\usepackage{lscape}

\title{WordPressによる学会オンライン大会サイト構築法}
\author{田辺晶史}
\date{\today}

%\renewcommand{\baselinestretch}{1.2}
\renewcommand{\prepartname}{第}
\renewcommand{\postpartname}{部}
\renewcommand{\prechaptername}{第}
\renewcommand{\postchaptername}{章}
\renewcommand{\presectionname}{}%  第
\renewcommand{\postsectionname}{}% 節
\renewcommand{\contentsname}{目次}
\renewcommand{\listfigurename}{図目次}
\renewcommand{\listtablename}{表目次}
\renewcommand{\refname}{引用文献}
\renewcommand{\bibname}{引用文献}
\renewcommand{\indexname}{索引}
\renewcommand{\figurename}{図}
\renewcommand{\tablename}{表}
\renewcommand{\appendixname}{付録}

\usepackage{float}
\usepackage{framed}
\definecolor{shadecolor}{gray}{0.9}
\newenvironment{content}{\begin{shaded}\vspace{-1em}\raggedright\ttfamily\footnotesize\setlength{\baselineskip}{1.4em}}{\end{shaded}\vspace{-1em}}
\newenvironment{pre}{\begin{leftbar}\raggedright\ttfamily\footnotesize\setlength{\baselineskip}{1.4em}}{\end{leftbar}\vspace{-1em}}
\newenvironment{cmd}{\begin{oframed}\raggedright\ttfamily\footnotesize\setlength{\baselineskip}{1.4em}}{\end{oframed}\vspace{-1em}}

\setlength{\textwidth}{\fullwidth}
\setlength{\evensidemargin}{\oddsidemargin}
\addtolength{\evensidemargin}{-2.5 true mm}
\addtolength{\oddsidemargin}{2.5 true mm}

\makeatletter
\renewcommand{\chapter}{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \global\@topnum\z@
  \secdef\@chapter\@schapter}
\makeatother

\renewcommand{\textbf}[1]{{\bfseries\sffamily#1}}

\bibliographystyle{jecon}

\begin{document}
\thispagestyle{empty}
\maketitle
\cleardoublepage
\pagenumbering{roman}
\tableofcontents
\cleardoublepage
\setlength{\parindent}{0em}
\setlength{\parskip}{1em plus 0.2em}
\parindent=0em
\parskip=1em plus 0.2em
\pagenumbering{arabic}

\chapter*{はじめに}
\addcontentsline{toc}{chapter}{はじめに}

本書はクリエイティブ・コモンズの表示-継承 4.0 国際ライセンスの下で配布します。
このライセンスの下では、原著作者の明示を行う限り、利用者は自由に本書を複製・頒布・展示することができます。
また、原著作者の明示と本ライセンスまたは互換性のあるライセンスの適用を行う限り、本書を改変した二次著作物の作成・配布も自由に行うことができます。
詳しい使用許諾条件を見るには\\
\href{https://creativecommons.org/licenses/by-sa/4.0/}{https://creativecommons.org/licenses/by-sa/4.0/}\\
をチェックするか、クリエイティブ・コモンズに郵便にてお問い合わせ下さい。
住所は Creative Commons, PO Box 1866, Mountain View, CA 94042, USA です。

本書が皆さんの役に立つことができましたら幸いです。
この機会を与えて下さった環境DNA学会、個体群生態学会の皆さんと、本書をお読みの皆さんに感謝します。

\chapter{各種サービスとの契約}

本書では、WordPressホスティングをKinsta、電子メール配信をSendGrid、オンデマンド動画配信はVimeo、リアルタイム動画配信はZoomを使用すると想定しています。
必ずしもこれらのサービスでなくてはいけないわけではありませんが、コストパフォーマンスとスケーラビリティの面でこれら以上のサービスは現状では存在しないと思います。
Kinstaはお金さえ積めば「落ちない」Webサイト運営ができ、SendGridでは同様に事実上青天井のメール配信ができます。
Vimeoは動画の配信には制限がありません(保存容量には上限がある)。
Zoomは配信・閲覧用アプリが普及していてウェビナーの参加者数上限が非常に大きい利点があります。
実はVimeoでもリアルタイム動画配信が可能ですが、ライブ配信用アプリを別途ホスト側がインストールしなければならない上、遠隔講演者数がPremiumプランで5人、Enterpriseプランで10人までという制限があり、アプリの操作にホストや遠隔講演者が慣れていないので、Zoomをおすすめします。
講演者が1ヶ所に集まって、オンラインでもその様子を配信する、というような用途ならVimeoは向いています。

また、\textbf{学会で独自ドメインを保有しており、DNS設定が可能であること、学会または代表者または担当者名義のクレジットカードがあることも前提}となります。
独自ドメインを保有していない場合は、Value-domainやさくらインターネット、お名前.comなどで取得して下さい(どれでも構いません)。
ここでは、保有ドメインが\texttt{hogehoge.hoge}、オンライン大会サブドメインが\texttt{meeting2021.hogehoge.hoge}と仮定して進めます。
また、オンライン大会管理者用メールアドレスは\texttt{meeting2021@hogehoge.hoge}と仮定します。
独自ドメインも、独自ドメインのWebサイトもメールアドレスもない場合、さくらインターネットのレンタルサーバおよび独自ドメインを契約するのがおすすめです。
ただし、独自ドメインのWebサイトをKinstaで作成することも可能です。
その場合は、メールボックスプランを選び、独自ドメインとメールアドレスだけさくらインターネットを利用すればいいでしょう。
なお、さくらインターネットのレンタルサーバは、アクセスが集中するとアクセス制限がかかってしまうので、大会Webサイト運営には向いていません。
それに対して、Kinstaはお金さえ払えばいくらアクセスが集中しても問題ありません。
さくらインターネットでもクラウドを契約すればウェブアクセラレータという機能で同様のことが可能ですが、設定がやや複雑です(料金も従量課金なのでお金さえ払えばアクセス制限は発生しないはずです)。
ウェブアクセラレータは、ドメイン取得、レンタルサーバ、クラウドの全てをさくらインターネットに統一すれば、\href{https://manual.sakura.ad.jp/cloud/webaccel/manual/tips-settings-webaccel-for-rs.html}{公式マニュアル}の通りに設定するだけで使用可能です。
さくらのレンタルサーバにはコンテンツブーストという機能もありますが、利用の条件が厳しく、\texttt{meeting2021.hogehoge.hoge}というドメインでは利用できません。
参加人数100名以下の小規模な集会であれば、さくらインターネットのレンタルサーバとリソースブーストという機能で十分対応可能だろうと思いますが、万が一アクセス制限が開催期間中に適用されてしまった場合、オンライン大会サイトにアクセスできなくなりますので、おすすめはしません。
さくらインターネットを使用する場合、ドメインの取得・設定、SSLの導入・設定、WordPressの導入は公式マニュアルを参照して下さい。

\section{Kinstaとの契約と設定}

「\href{https://kinsta.com/jp/plans/}{プラン一覧のページ}」を表示し、プランを選択して「選ぶ」を押して下さい。
メールアドレス、姓、名、パスワードを入力して「続く」を押し、次のページで契約する法人名あるいは個人名と所在地、クレジットカード情報を入力して「完了」を押すと契約完了です。
プランは月額100米ドルのBUSINESS 1以上にして下さい。
これは、STARTERやPROプランでは、PHPワーカー数が少ないため会員制サイトの構築の際にパフォーマンスが不足する可能性があるためです。
また、ディスク容量が不足する場合は、十分な容量になるまでプランを上位のものに変えて下さい。
無料CDN転送容量、月間訪問数は上限を超えれば従量課金になるので、とりあえずBUSINESS 1にしておけばいいでしょう。
ただし、学会大会程度でものすごい金額になることはまずないとは思いますが、従量課金は青天井なので注意は必要です。
不安があるなら大会の開催期間だけENTERPRISE 1以上のプランにしましょう。

Kinstaとの契約が完了すると、「\href{https://my.kinsta.com/login/?lang=jp}{MyKinsta}」にログインできるようになります。
Webサイトを作成するには、MyKinstaにログインして、「サイト」メニューから「サイトを追加」を選択します。
「WordPressをインストール」を選択し、「ドメイン名」は\texttt{meeting2021.hogehoge.hoge} (ただし、DNSのAレコードは契約した業者に依頼して編集する必要がある。後述)、「サイトの名前」は短めのわかりやすいタイトルを付けます(Hogehoge Meeting 2021など)。
「ロケーション」は参加者の多い地域を選びます(通常はTokyo)。
「WordPressサイトタイトル」は短めのわかりやすいタイトルを付けて下さい(サイトの名前と同じで構いません)。
「WordPressの管理者のユーザー名」はAdministratorなどの適当な管理者アカウント名を入力します。
「WordPressの管理者のパスワード」は自動生成されたものが入力されているはずなので、そのままで構いません(ただしどこかにメモしておいて下さい)。
「WordPressの管理者の電子メール」は主管理担当者のメールアドレス、つまり\texttt{meeting2021@hogehoge.hoge}とします。
「言語」はEnglish (US)を推奨します。
その他のチェックボックスは全て外しておきます。
「追加」を押すとWebサイトが追加されます(数分程度かかります)。

Webサイトの追加後、「サイト」メニュー内の追加したサイトを選択し、追加したサイトの設定を行います。
まず、「ドメイン」メニューを選択してサイト作成時に指定したドメインがドメインのリストにあり、プライマリドメインが適切に設定されていることを確認します。
ドメイン登録業者に依頼して、DNSのAレコードを「情報」メニューの「サイトのIPアドレス」にあるIPアドレスに設定する必要があります(ドメイン登録業者によって方法は異なりますが、Webサイトにログインしてメニューから手続きすることがほとんどです)。
DNSレコードが適切に設定できると、\url{http://meeting2021.hogehoge.hoge/}にアクセスすることでWebサイトが表示されるはずですので、確認します。
Webサイトが表示できない場合は、DNSレコードの設定を見直します(なお、DNSレコードの設定は反映に多少時間がかかることがあります)。
この時点ではhttpsが有効化されていませんので、「ツール」メニューの「SSL証明書」欄で「無料のSSL証明書を生成する」を選択すればSSLを有効化できます(Let's encryptによる無料証明書が発行、インストールされ、自動更新されるよう設定されます)。
SSL証明書の生成後、「強制HTTPS」欄のグレーアウトが解除されるので、「有効にする」を押してhttpを無効化して完全https化します。
あとはKinsta CDNの有効化が必要ですが、後述するWordPressの設定が全て完了するまでは無効化しておく方がいいと思います。

\section{SendGridとの契約と設定}

日本の代理店である構造計画研究所の「\href{https://sendgrid.kke.co.jp/app?p=signup.index}{新規会員登録のページ}」を開き、メールアドレスを入力して「確認メールを送信する」を押します。
すると、メールアドレスに構造計画研究所からメールが届くので、その中に書いてあるURLにアクセスします。
契約者情報といくつかの質問に対する回答を入力して送信すると、数日中にログイン用の情報が送られてきます。
質問には、以下のように回答します。

\begin{description}
\item[質問1 どういった用途で利用されますか？] 自社の社内システム、個人で使用しているツール
\item[質問2 どのようなメールを送信されますか？] トランザクションメール（通知メールなど）
\item[質問3 誰に対してメールを送信しますか？] 自分・知人（サークルやコミュニティの関係者など）・自社内の関係者
\item[質問4 誰のメールを送信しますか？] 自分自身のメール・自社社員、自社のメール・自社システムの通知メール（問合せフォームの受付完了通知など）
\item[質問5 メール送信時に指定する予定のFromアドレスをご記入ください] \texttt{meeting2021@hogehoge.hoge}
\item[質問6 月間送信通数] 参加者数×100～1000程度を入力
\item[質問7 利用用途の詳細] WordPressで構築した学会コミュニティサイトから、サイト会員への通知メールの送信に利用する
\item[質問8 備考欄] 空欄
\end{description}

登録時にはFreeプランでまず登録され、その後にログインして「\href{https://sendgrid.kke.co.jp/app?p=mypage.creditcard}{クレジットカード情報登録}」を行い、「\href{https://sendgrid.kke.co.jp/app?p=mypage.plan}{プラン変更}」で有料プランに移行します。
プランは月額10,000円のPro 100k以上のプランで契約して下さい。
これ未満のプランでは、他の契約者と共用のIPアドレスからメールが送信されますが、他の契約者が迷惑メールを送信してブラックリストに登録されてしまうと、学会の送信したメールも受信拒否されてしまったりする問題が起きます。
Pro 100k以上のプランでは、契約者ごとに固有のIPアドレスが付与されるため、他の契約者の行為の影響を受けなくなります。
念のため、二要素認証は有効化しておきましょう。

SendGridの設定は「\href{https://sendgrid.kke.co.jp/app?p=login.index}{ログインページ}」からログインして、「SendGridダッシュボードへ」を押してダッシュボードページから行います。
「Settings」内の「Mail Settings」および「Tracking」を開いて、全ての設定を「Disabled」にしておきましょう。
デフォルトでは、送信メール内のURLを、各ユーザーがアクセスしたかどうかを確認できる転送URLに置換する機能などが有効になっていると思います。
また、メールがしっかり届くようにするため、ドメイン認証の有効化を行います。
この手続方法は構造計画研究所の「\href{https://sendgrid.kke.co.jp/docs/Tutorials/D_Improve_Deliverability/using_whitelabel.html}{独自ドメインを利用する}」を参照して行って下さい。
ここではDomain AuthenticationとReverse DNSだけ設定すればよく、Link Brandingは不要です。

上記の設定が終わったら、WordPressから送信するためのAPIキーの作成を行います。
SendGridダッシュボードにアクセスし、「Settings」内の「API Keys」を表示します。
「Create API Key」を押してAPIキー作成メニューに入ります。
「API Key Name」は適当な名前を付けます(WordPressMailとかでいいでしょう)。
「API Keys Permissions」は「Restricted Access」を選択し、「Mail Send」のスイッチを入れて、「Create \& View」を押すと、発行されたAPIキーが表示されますので、どこかにメモしておきます。
「Done」を押すと表示が消えて二度と表示されませんのでご注意下さい。
APIキーを忘れてしまった場合、作成したAPIキーを削除し、再度作成する手続きを行って下さい。

\chapter{WordPressの設定}

オンライン大会サイトのドメインが\texttt{meeting2021.hogehoge.hoge}の場合、\url{https://meeting2021.hogehoge.hoge/wp-admin/}にアクセスすることでログイン画面に入ることができます。
MyKinstaで設定した「WordPressの管理者のユーザー名」と「WordPressの管理者のパスワード」を使ってログインし、ダッシュボード\url{https://meeting2021.hogehoge.hoge/wp-admin/}を表示して下さい。

次に左サイドバーから「Posts→All Posts」を表示し、全ての投稿のチェックボックスにチェックを入れて、「Bulk actions→Move to Trash→Apply」で一旦全ての投稿を削除します。
「Pages→All Pages」でも同様に全ての固定ページを削除します。

\section{テーマのインストール}

左サイドバーの「Appearance→Themes」を表示し、上部の「Add New」ボタンを押すと、新しいテーマを追加する画面になりますので、検索ボックスにテーマ名などのキーワードを入力すれば該当するテーマがリストアップできます。
WordPress純正テーマでは「Twenty Sixteen」がおすすめです。
他のテーマも含めると「Sparkling」がいいでしょう。
これ以降では「Sparkling」をインストールしたと仮定して進めます。

\section{プラグインのインストール}

左サイドバーから「Plugins→Installed Plugins」を選択します。
全てのプラグインの左チェックボックスにチェックを入れて、「Bulk actions→Delete→Apply」で一旦全てのプラグインを削除します。
次に、「Plugins→Add New」から下記のプラグインをインストールします。
Keyword欄に入力すればリストアップされますが、紛らわしい名前のプラグインが多数あるので注意して下さい。
また、検索キーワードと一致度が高い名前のプラグインが優先的に表示されるわけではないようです。
Activateは一括で行うので、検索→Install Now→検索→・・・と次々にインストールを行っていきます。

\begin{itemize}
\item All In One WP Security \& Firewall
\item BuddyPress
\item BuddyPress Members only
\item Mass Messaging in BuddyPress
\item bbPress
\item bbp style pack
\item Content Control
\item Democracy Poll
\item Inline Image Upload for BBPress
\item GD bbPress Attachments
\item No Right Click Images Plugin
\item Protect Uploads
\item FancyBox for WordPress
\item Timetable and Event Schedule by MotoPress
\item Post SMTP Mailer/Email Log
\item Import and export users and customers
\item Peter's Login Redirect
\item Resend Welcome Email
\item SB Welcome Email Editor
\item Custom Login Page Customizer by Colorlib
\item WP Multibyte Patch
\end{itemize}

次に、左サイドバーから「Plugins→Installed Plugins」を表示し、全てのプラグインの左チェックボックスにチェックを入れて、「Bulk actions→Activate→Apply」で全てのプラグインを有効化します。

\section{SFTPでのファイルアップロード}

さらにいくつかのファイルをWordPressに手動で追加する必要があります。
KinstaはFTPをサポートしていないため、SFTPを使用してアップロードします。
KinstaへのSFTPの接続方法は、\href{https://kinsta.com/jp/knowledgebase/how-to-use-sftp/}{公式の知識ベース}に説明がありますので参照して下さい。
アップロードするファイルと場所は以下の通りです。

\begin{description}
\item[\href{https://github.com/astanabe/OnlineAnnualMeeting/blob/main/bp-custom.php}{bp-custom.php}] \texttt{wp-content/plugins/}
\item[\href{https://github.com/astanabe/OnlineAnnualMeeting/blob/main/resend-welcome-email-to-allusers.php}{resend-welcome-email-to-allusers.php}] \texttt{wp-content/mu-plugins/}
\item[\href{https://github.com/astanabe/OnlineAnnualMeeting/blob/main/resend-welcome-email-to-nologinusers.php}{resend-welcome-email-to-nologinusers.php}] \texttt{wp-content/mu-plugins/}
\end{description}

\section{WordPress設定}

左サイドバーの「Settings→General」を表示します。
以下のように設定して下さい。

\begin{description}
\item[Site Title] Hogehoge Meeting 2021
\item[Tagline] 空欄
\item[WordPress Address (URL)] \url{https://meeting2021.hogehoge.hoge}
\item[Site Address (URL)] \url{https://meeting2021.hogehoge.hoge}
\item[Administration Email Address] \texttt{meeting2021@hogehoge.hoge}
\item[Membership: Anyone can register] チェックを外す
\item[New User Default Role] Subscriber
\item[Site Language] English (United States)
\item[Timezone] Tokyo
\item[Date Format] Y-m-d
\item[Time Format] H:i
\item[Week Starts On] Monday
\end{description}

「Save Changes」を押して設定を保存し、次に「Settings→Writing」を以下のように設定します。

\begin{description}
\item[Default Post Category] Uncategorized
\item[Default Post Format] Standard
\item[Mail Server] そのまま
\item[Login Name] そのまま
\item[Password] そのまま
\item[Default Mail Category] そのまま
\end{description}

「Save Changes」を押して設定を保存し、次に「Pages→Add New」で新しい固定ページの編集画面に入ります。
「Add title」と表示されているところに「Frontpage」と入力し、本文は空のままか、とりあえず仮の内容を書いて、右上の「Publish」を押して公開し、左上のWordPressロゴマークを押してダッシュボードに戻ります。
「Settings→Reading」を以下のように設定します。

\begin{description}
\item[Your homepage displays] A static page (select below)
\item[Homepage] Frontpage
\item[Posts page] そのまま
\item[Blog pages show at most] 10
\item[Syndication feeds show the most recent] 10
\item[For each post in a feed, include] Full text
\item[Search engine visibility: Discourage search engines from indexing this site] チェックを入れる
\end{description}

「Save Changes」を押して設定を保存し、次に「Settings→Discussion」を以下のように設定します。

\begin{description}
\item[Default post settings: Attempt to notify any blogs linked to from the post] チェックを外す
\item[Default post settings: Allow link notifications from other blogs (pingbacks and trackbacks) on new posts] チェックを外す
\item[Default post settings: Allow people to submit comments on new posts] チェックを外す
\item[Other comment settings: Comment author must fill out name and email] チェックを入れる
\item[Other comment settings: Users must be registered and logged in to comment] チェックを入れる
\item[Other comment settings: Automatically close comments on posts older than 14 days] チェックを外す
\item[Other comment settings: Show comments cookies opt-in checkbox, allowing comment author cookies to be set] チェックを入れる
\item[Other comment settings: Enable threaded (nested) comments X levels deep] チェックを入れてXを5にする
\item[Other comment settings: Break comments into pages with 50 top level comments per page...] チェックを外す
\item[Other comment settings: Comments should be displayed with the X comments at the top of each page] Xをolderにする
\item[Email me whenever: Anyone posts a comment] チェックを外す
\item[Email me whenever: A comment is held for moderation] チェックを入れる
\item[Before a comment appears: Comment must be manually approved] チェックを外す
\item[Before a comment appears: Comment author must have a previously approved comment] チェックを外す
\item[Comment Moderation: Hold a comment in the queue if it contains X or more links] Xを50にする
\item[Comment Moderation: When a comment contains any of these words in its content...] 空欄
\item[Disallowed Comment Keys: When a comment contains any of these words in its content...] 空欄
\item[Avatar Display: Show Avatars] チェックを入れる
\item[Maximum Rating] G — Suitable for all audiences
\item[Default Avatar] Retro (Generated)
\end{description}

「Save Changes」を押して設定を保存し、次に「Settings→Media」を以下のように設定します。

\begin{description}
\item[Thumbnail size: Width] 600
\item[Thumbnail size: Height] 600
\item[Medium size: Max Width] 900
\item[Medium size: Max Height] 1200
\item[Large size: Max Width] 1200
\item[Large size: Max Height] 1600
\item[Uploading Files: Organize my uploads into month- and year-based folders] チェックを入れる
\end{description}

「Save Changes」を押して設定を保存し、次に「Settings→Permalinks」を以下のように設定します。

\begin{description}
\item[Common Settings] Post name
\item[Optional: Category base] 空欄
\item[Optional: Tag base] 空欄
\item[Timetable Permalinks: Column base] timetable/column
\item[Timetable Permalinks: Event base] timetable/event
\item[Timetable Permalinks: Event Category base] timetable/category
\item[Timetable Permalinks: Event Tag base] timetable/tag
\end{description}

「Save Changes」を押して設定を保存し、次に「Settings→Privacy」を表示し、「Create a new Privacy Policy Page」の横にある「Create」ボタンを押します。
自動的にデフォルトのプライバシーポリシーページが作成されますので、ひとまずそのままで右上の「Publish」を押して公開し、左上のWordPressロゴマークを押してダッシュボードに戻ります。

次に「Settings→Login/logout redirects」を以下のように設定します。

\begin{description}
\item[Specific users] そのまま
\item[Specific roles] そのまま
\item[Specific levels] そのまま
\item[All other users: URL] \url{https://meeting2021.hogehoge.hoge/members/[variable]username[/variable]/profile/}
\item[All other users: Logout URL] \url{https://meeting2021.hogehoge.hoge/}
\item[Post-registration: ] \url{https://meeting2021.hogehoge.hoge/members/[variable]username[/variable]/profile/}
\item[Customize plugin settings: Allow a POST or GET "redirect\_to" variable to take redirect precedence] No
\item[Customize plugin settings: Allow a POST or GET "redirect\_to" logout variable to take redirect precedence] No
\end{description}

次に「Settings→BuddyPress」を以下のように設定します。

\begin{description}
\item[Components: Extended Profiles] チェックを入れる
\item[Components: Account Settings] チェックを入れる
\item[Components: Friend Connections] チェックを入れる
\item[Components: Private Messaging] チェックを入れる
\item[Components: Activity Streams] チェックを入れる
\item[Components: Notifications] チェックを入れる
\item[Components: User Groups] チェックを入れる
\item[Components: Site Tracking] チェックを入れる
\item[Options: Toolbar: Show the Toolbar for logged out users] チェックを入れる
\item[Options: Account Deletion: Allow registered members to delete their own accounts] チェックを入れる
\item[Options: Template Pack] BuddyPress Nouveau
\item[Options: Profile Photo Uploads: Allow registered members to upload avatars] チェックを入れる
\item[Options: Cover Image Uploads: Allow registered members to upload cover images] チェックを入れる
\item[Options: Profile Syncing: Enable BuddyPress to WordPress profile syncing] チェックを入れる
\item[Options: Group Creation: Enable group creation for all users] チェックを外す
\item[Options: Group Photo Uploads: Allow customizable avatars for groups] チェックを外す
\item[Options: Group Cover Image Uploads: Allow customizable cover images for groups] チェックを外す
\item[Options: Post Comments: Allow activity stream commenting on posts and comments] チェックを外す
\item[Options: Activity auto-refresh: Automatically check for new items while viewing the activity stream] チェックを入れる
\item[Pages: Members] Members
\item[Pages: Activity Streams] Activity
\item[Pages: User Groups] Groups
\end{description}

次に「Settings→Forums」を以下のように設定します。

\begin{description}
\item[Forum User Settings: Roles: Automatically give registered visitors the X forum role] チェックを入れてXをParticipantにする
\item[Forum User Settings: Flooding: Allow flood protection by throttling users for X seconds after posting] チェックを入れてXを10にする
\item[Forum User Settings: Editing: Allow users to edit their content for X minutes after posting] チェックを入れてXを5にする
\item[Forum User Settings: Anonymous: Allow guest users without accounts to create topics and replies] チェックを外す
\item[Forum Features: Auto-embed links: Embed media (YouTube, Twitter, Flickr, etc...) directly into topics and replies] 
\item[Forum Features: Reply Threading: Enable threaded (nested) replies X levels deep] チェックを入れる
\item[Forum Features: Revisions: Allow topic and reply revision logging] チェックを入れてXを5にする
\item[Forum Features: Favorites: Allow users to mark topics as favorites] チェックを入れる
\item[Forum Features: Subscriptions: Allow users to subscribe to forums and topics] チェックを入れる
\item[Forum Features: Engagements: Allow tracking of topics each user engages in] チェックを入れる
\item[Forum Features: Topic tags: Allow topics to have tags] チェックを入れる
\item[Forum Features: Search: Allow forum wide search] チェックを入れる
\item[Forum Features: Post Formatting: Add toolbar \& buttons to textareas to help with HTML formatting] チェックを入れる
\item[Forum Features: Forum Moderators: Allow forums to have dedicated moderators] チェックを入れる
\item[Forum Features: Super Moderators: Allow Moderators and Keymasters to edit users] チェックを外す
\item[Forum Theme Packages: Current Package: X will serve all bbPress templates] XをbbPress Defaultにする
\item[Topics and Replies Per Page: Topics: X per page] Xを100にする
\item[Topics and Replies Per Page: Replies: X per page] Xを100にする
\item[Topics and Replies Per RSS Page: Topics: X per page] Xを100にする
\item[Topics and Replies Per RSS Page: Replies: X per page] Xを100にする
\item[Forum Root Slug: Forum Root] forums
\item[Forum Root Slug: Forum Prefix: Prefix all forum content with the Forum Root slug (Recommended)] チェックを入れる
\item[Forum Root Slug: Forum root should show] Forum Index
\item[Forum Single Slugs: Forum] forum
\item[Forum Single Slugs: Topic] topic
\item[Forum Single Slugs: Topic Tag] topic-tag
\item[Forum Single Slugs: Topic View] view
\item[Forum Single Slugs: Reply] reply
\item[Forum Single Slugs: Edit] edit
\item[Forum Single Slugs: Search] search
\item[Forum User Slugs: User Base] users
\item[Forum User Slugs: Topics Started] topics
\item[Forum User Slugs: Replies Created] replies
\item[Forum User Slugs: Favorite Topics] favorites
\item[Forum User Slugs: Subscriptions] subscriptions
\item[Forum User Slugs: Engagements] engagements
\item[Forum Integration for BuddyPress: Group Forums: Allow BuddyPress Groups to have their own forums] チェックを外す
\item[Forum Integration for BuddyPress: Use X to contain your group forums, or create a new one] そのまま
\end{description}

次に「Settings→Fancybox for WP」を以下のように設定します。

\begin{description}
\item[Appearance: Close Button] 有効
\item[Appearance: Toolbar] 有効
\item[Appearance: Border] 無効
\item[Appearance: Padding] そのまま
\item[Appearance: Overlay Options] 有効
\item[Appearance: Title] 無効
\item[Appearance: Hide caption] 有効
\item[Appearance: Navigation Arrows] 有効
\item[Animations: Zoom Options] 有効
\item[Animations: Animation Type: Animation type when opening FancyBox] fade
\item[Animations: Animation Type: Speed in miliseconds of the FancyBox opening animation] 500
\item[Animations: Animation between slides Options: Select Animation type for the slides] slide
\item[Animations: Animation between slides Options: Speed in miliseconds of the animation...] 300
\item[Behaviour: Close on Content Click] 無効
\item[Behaviour: Close on Overlay Click] 無効
\item[Behaviour: Keyboard navigation] 有効
\item[Behaviour: Loop Galleries] 無効
\item[Behaviour: Mouse Wheel Navigation] 有効
\item[Behaviour: Zoom On Click] 無効
\item[Behaviour: Woocommerce: Disable on Woocommerce Shop page] 無効
\item[Behaviour: Woocommerce: Disable on Woocommerce products] 無効
\item[Behaviour: Exclude PDF files] 無効
\item[Behaviour: Disable FancyBox on mobile] 無効
\item[Galleries: Gallery Type] Make a gallery for all images on the page
\end{description}

次に「Settings→No Right Click Images」を以下のように設定します。

\begin{description}
\item[Allow Right Click for Logged Users] チェックを外す
\item[Disable Dragging of images] チェックを入れる
\item[Disable Touch events] チェックを入れる
\item[Disable Gesture events] チェックを外す
\item[Disable context menu on Apple devices] チェックを入れる
\item[Admin can always right click images] チェックを入れる
\end{description}

次に「Settings→bbp Style Pack」を以下のように設定します。

\begin{description}
\item[Forums Index Styling: ] 
\item[Forums Index Styling: ] 
\item[Forums Index Styling: ] 
\item[Forums Index Styling: ] 
\item[Forum Templates: ] 
\item[Forum Display: ] 
\item[Forum Order: ] 
\item[Freshness Display: ] 
\item[Breadcrumbs: ] 
\item[Buttons: ] 
\item[Login: ] 
\item[Login Failures: ] 
\item[Forum Roles: ] 
\item[Subscription emails: ] 
\item[Topic Order: ] 
\item[Topics Index Styling: ] 
\item[Topic Previews: ] 
\item[Topic/Reply Display: ] 
\item[Topic/Reply Form: ] 
\item[Profile: ] 
\item[Search Styling: ] 
\item[Shortcodes: ] 
\item[Unread posts: ] 
\item[Widgets: ] 
\item[Latest Activity Widget styling: ] 
\item[Custom CSS: ] 
\item[CSS location: ] 
\end{description}

次に「Settings→Mass Messaging」を以下のように設定します。

\begin{description}
\item[Features: Members: Allow mass messaging to members] チェックを入れる
\item[Features: Members: Allow the ability to select all members] チェックを入れる
\item[Features: Members: Show all members, not just friends] チェックを入れる
\item[Features: Groups: Allow mass messaging to groups] チェックを入れる
\item[Features: Groups: Allow the ability to select all groups] チェックを外す
\item[Features: Groups: Show all groups, not just those with membership] チェックを入れる
\end{description}

次に「Settings→Democracy Poll」を以下のように設定します。

\begin{description}
\item[Settings: Log data \& take visitor IP into consideration? (recommended)] 
\item[Settings: How many days to keep Cookies alive?] 
\item[Settings: HTML tags to wrap the poll title] 
\item[Settings: Global Polls options: How to sort the answers during voting, if they don't have order? (default option)] 
\item[Settings: Global Polls options: Only registered users allowed to vote (global option)] 
\item[Settings: Global Polls options: Prohibit users to add new answers (global Democracy option)] 
\item[Settings: Global Polls options: Remove the Revote possibility (global option)] 
\item[Settings: Global Polls options: Don't show poll results (global option)] 
\item[Settings: Global Polls options: Don't show poll results link (global option)] 
\item[Settings: Global Polls options: Hide vote button] 
\item[Settings: Global Polls options: Dasable post metabox] 
\item[Settings: Others: Force enable gear to working with cache plugins] 
\item[Settings: Others: Add styles and scripts directly in the HTML code (recommended)] 
\item[Settings: Others: Add plugin menu on the toolbar?] 
\item[Settings: Others: Add fast Poll insert button to WordPress visual editor (TinyMCE)?] 
\item[Settings: Others: Check if you see something like "no\_IP\_\_123" in IP column on logs page. (not recommended) Or if IP detection is wrong. (for cloudflare)] 
\item[Settings: Others: Role names, except 'administrator' which will have access to manage plugin] 
\end{description}

次に「Settings→Content Control」を以下のように設定します。

\begin{description}
\item[] 
\end{description}

\section{その他の設定}

\chapter{実際の運用方法}

\section{大会案内ページの公開}

学会公式サイト上に大会案内ページを作成して公開するのがいいでしょう。
Googleサイトなどの無料Webサイト構築サービスでも構いませんが、大会後に「大会が開催されたこと」が確認できるWebサイトが存在しないと困ることがあるため、継続性に不安のある無料サービスはおすすめしません。
また、オンライン大会サイト上に大会案内ページを作成することもおすすめしません。
これは、オンライン大会サイトは大会後に閉鎖する前提だからです。

\section{参加者の募集}

GoogleフォームやMicrosoft Formsなどのアンケートフォーム作成サービスを利用するのがおすすめです。
どちらのサービスでも無料で容易に大会参加登録用フォームが作成できますが、Office 365ユーザーならMicrosoft Formsの方がExcelなどとの連携は多少楽かもしれません。
どちらのサービスも使いたくない場合、WordPressにContact Form 7というフォーム作成プラグインと、FlamingoというContact Form 7で送信された内容をWordPress内に保存・出力できるプラグインをインストールして使用するといいでしょう。
フォームでは、以下の情報を参加者全員から取得します。

\begin{itemize}
\item E-mailアドレス
\item 姓 (Hogehogeなど)
\item 名 (Fugafugaなど)
\item フルネーム (Fugafuga Hogehogeなど)
\item 短縮フルネーム (FHogehogeなど)
\item 所属 (Hogehoge Universityなど)
\item 所属の短縮名 (HogehogeUなど)
\end{itemize}

なお、E-mailアドレスに携帯電話会社のメールアドレスを使用することは禁止した方がいいでしょう。
こちらからのメールを受信できないことが非常に多いためです。
特にauのメールアドレスは絶対に使用禁止にすべきです。

上記はオンライン大会サイトへのユーザー登録に必要な情報しか挙げていません。
実際の大会運営では、参加種別(一般会員、学生会員、一般非会員、学生非会員、出展・協賛企業など)、日毎に分けて別料金にしたりする場合は参加日、サテライト企画や懇親会がある場合はそれらへの参加の有無など、他にも収集すべき情報はあるでしょうし、最終的な参加費用合計を表示する必要もあるでしょう。
また、代理登録(メールアドレス使用者と参加者が一致しないケース)は一切禁止する必要があります。
オンライン大会サイトへの登録時に参加者に紐付いたメールアドレスが必須となるためです。
海外からの参加者にも配慮するため、名前関連は英語表記に全て統一します(漢字なし)。
オンライン大会サイトではユーザーアカウント名も必要になりますが、これは短縮フルネームと所属の短縮名から自動生成するのがよいでしょう。

上述の情報に基づいて、WordPress上のユーザーの名前に関する属性を以下のように設定することになります。

\begin{description}
\item[display\_name] 表示名。「短縮フルネーム (所属の短縮名)」とするのがよいでしょう
\item[nickname] display\_nameと同じでよいでしょう
\item[first\_name] 名
\item[last\_name] 姓
\item[user\_login] WordPress内でのユーザー名。「短縮フルネーム\_所属の短縮名」または「フルネームからアルファベット以外除去したもの\_所属の短縮名」にするとよいでしょう
\item[user\_nicename] アカウント名を全て小文字にしたもの
\end{description}

さらに、BuddyPressでは「Name」という属性を使用しています。
「Name」の内容は「display\_name」と同じでよいでしょう。

\section{ユーザーのSite RoleとForum Roleと所属Group}

ユーザーには「Site Role」と「Forum Role」と「所属Group」の3つの属性があります。
「Site Role」と「Forum Role」はユーザーアカウントごとに一つだけです。
「所属Group」はユーザーアカウントごとに複数あり得ます。
「Site Role」と「Forum Role」によって、オンライン大会サイト上でそのユーザーアカウントに許された権限(Capabilities)が決まります。

「Site Role」は管理者であるAdministratorと副管理者としてのEditorと一般参加者Subscriberの3つを利用します(他にもあるが使用しない。副管理者もAdministratorにしても問題ありません)。
「Forum Role」は管理者であるKeymasterと副管理者としてのModerator、フォーラムのトピック新規作成権限を持つ＝発表者にはPresenter、フォーラムのトピックへの返信権限しかない＝発表しない一般参加者にはCommentatorを利用します。
ただし、ポスター賞審査員には「Forum Role」としてAdjudicatorを与えます(ポスター賞審査を参加者全員の投票方式にするなら不要です)。
また、出展企業の担当者のうち、出展にのみ関与し大会には参加しない(閲覧権限もない)担当者は、「Forum Role」をExhibitorとします(大会にも参加する担当者はCommentator、発表もする担当者はPresenterとします)。
まとめると以下のようになります。

\begin{description}
\item[発表者]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Subscriber
\item[Forum Role] Presenter
\end{description}
\item[非発表者]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Subscriber
\item[Forum Role] Commentator
\end{description}
\item[審査員]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Subscriber
\item[Forum Role] Adjudicator
\end{description}
\item[出展企業担当者(大会不参加)]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Subscriber
\item[Forum Role] Exhibitor
\end{description}
\item[副管理者]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Editor
\item[Forum Role] Moderator
\end{description}
\item[管理者]\mbox{}\\
\begin{description}
\vspace{-17pt}
\item[Site Role] Administrator
\item[Forum Role] Keymaster
\end{description}
\end{description}

「所属Group」は、管理者がMass Messaging時に送信先として利用するためのものです。
「全メンバー」、「口頭発表者」、「ポスター発表者」、「出展企業」の4つに分けるのがよいでしょう。
ただし、口頭発表賞がある場合は口頭発表賞候補者グループも作成します。
また、ポスター賞がある場合もポスター賞候補者グループを作成します。
したがって、ユーザーの「所属Group」は以下のようになります。

\begin{description}
\item[口頭発表者で口頭発表賞候補者] all-members, oral-presenters, oral-prize-candidates
\item[口頭発表者で口頭発表賞非候補者] all-members, oral-presenters
\item[ポスター発表者でポスター賞候補者] all-members, poster-presenters, poster-prize-candidates
\item[ポスター発表者でポスター賞非候補者] all-members, poster-presenters
\item[出展企業担当者] all-members, exhibitors
\item[その他参加者] all-members
\item[管理者・副管理者] 全グループに所属
\end{description}

そのほか、学会運営や大会運営に関係する委員会のグループなども必要に応じて作成できます。
これらのグループには、所属する人しか参加できないフォーラムを作成できるので、運営関係者の連絡専用フォーラムをオンライン大会サイト内に作成することもできます。

\section{参加者向け案内ページの作成}

\subsection{プライバシーポリシーページの作成}

\subsection{全参加者向け案内ページの作成}

\subsection{口頭発表者向け案内ページの作成}

\subsection{ポスター発表者向け案内ページの作成}

\subsection{出展企業向け案内ページの作成}

\section{Welcome E-mailの作成}

\subsection{通常のWelcome E-mail}

\subsection{アカウント有効化をいつまでもしない人への再送用Welcome E-mail}

\section{口頭発表ページと質疑応答用フォーラムの作成}

\section{ポスター発表用フォーラムの作成}

\section{参加者のオンライン大会サイトへのユーザー登録}

Import and export users and customersを使う

\section{発表用ポスター・企業展示の掲載期間中の対応}

\section{大会開会以降}

Forum Roleの変更。
PresenterをCommentatorに変更して編集権限を停止する。
ポスター賞審査員はAdjudicatorに変更する。

\bibliography{onlineannualmeeting}
\addcontentsline{toc}{chapter}{引用文献}

\end{document}
